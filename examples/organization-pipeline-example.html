<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>EkteIntelligens SDK - Organization Pipeline Example</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }
            .form-section {
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .form-group {
                margin-bottom: 15px;
            }
            label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }
            input,
            select,
            textarea {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                box-sizing: border-box;
            }
            input:focus,
            select:focus,
            textarea:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
            }
            button {
                background-color: #007bff;
                color: white;
                padding: 12px 24px;
                border: none;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                width: 100%;
            }
            button:hover {
                background-color: #0056b3;
            }
            .checkbox-group {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 15px;
            }
            .checkbox-group input[type="checkbox"] {
                width: auto;
            }
            .demo-info {
                background: #e3f2fd;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 30px;
            }
            .demo-info h3 {
                margin-top: 0;
                color: #1976d2;
            }
            .demo-info ul {
                margin: 10px 0;
                padding-left: 20px;
            }
            .demo-info li {
                margin-bottom: 5px;
            }
            .status {
                margin-top: 20px;
                padding: 15px;
                border-radius: 4px;
                font-weight: bold;
            }
            .success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .error {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .info {
                background-color: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }
            .campaign-section {
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .campaign-section h3 {
                margin-top: 0;
                color: #333;
            }
            .campaign-section code {
                background: #f4f4f4;
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 12px;
            }
            /* Complex selector structure for testing querySelector */
            .bv-ibe {
                padding: 20px;
            }
            .styleThemeContainer.bv-group.bv-contents {
                padding: 15px;
            }
            .bv-flex.bv-justify-between.bv-gap-\[20px\] {
                display: flex;
                justify-content: space-between;
                gap: 20px;
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <h1>EkteIntelligens SDK - Organization Pipeline Example</h1>

        <div class="demo-info">
            <h3>ðŸŽ¯ Organization Pipeline Testing</h3>
            <p>
                This example demonstrates the Organization Pipeline Tool with
                various selector types and scenarios:
            </p>
            <ul>
                <li>
                    <strong>Campaign 1:</strong> Simple signup form with email
                    input (name selector) and complex querySelector submit
                    button
                </li>
                <li>
                    <strong>Campaign 2:</strong> Booking form with email input
                    (name selector), toggle checkbox (id selector), and submit
                    button (name selector)
                </li>
                <li>
                    <strong>Selector Types:</strong> name, id, querySelector,
                    class
                </li>
                <li>
                    <strong>Features:</strong> Input mapping, button toggles,
                    additional properties, pipeline execution
                </li>
            </ul>
        </div>

        <div class="container">
            <!-- Campaign 1: Signup Form -->
            <div class="campaign-section">
                <h3>Campaign 1: Signup Form</h3>
                <p>
                    <strong>Campaign ID:</strong>
                    <code>30893953-c953-4137-b9aa-2a2ff3f9f2e9</code>
                </p>
                <p>
                    Tests: <code>name</code> selector for input,
                    <code>querySelector</code> for submit button
                </p>

                <div class="bv-ibe">
                    <div class="styleThemeContainer bv-group bv-contents">
                        <div>
                            <main>
                                <form id="signup-form">
                                    <div class="form-group">
                                        <label for="signup-email">Email:</label>
                                        <input
                                            type="email"
                                            name="email"
                                            id="signup-email"
                                            placeholder="Enter your email"
                                        />
                                    </div>
                                    <div
                                        class="bv-flex bv-justify-between bv-gap-[20px]"
                                    >
                                        <button type="button">
                                            Submit Signup
                                        </button>
                                    </div>
                                </form>
                            </main>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Campaign 2: Booking Form -->
            <div class="campaign-section">
                <h3>Campaign 2: Booking Form</h3>
                <p>
                    <strong>Campaign ID:</strong>
                    <code>c9edaae1-42e5-4115-b680-b5e22b049411</code>
                </p>
                <p>
                    Tests: <code>name</code> selector for input,
                    <code>id</code> selector for toggle button,
                    <code>name</code> selector for submit button
                </p>

                <form id="booking-form">
                    <div class="form-group">
                        <label for="booking-email">Email Address:</label>
                        <input
                            type="email"
                            name="emailAddress"
                            id="booking-email"
                            placeholder="Enter your email"
                        />
                    </div>

                    <div class="checkbox-group">
                        <input
                            type="checkbox"
                            id="newsletter_cb"
                            name="newsletter"
                        />
                        <label for="newsletter_cb"
                            >Subscribe to newsletter</label
                        >
                    </div>

                    <button
                        type="button"
                        name="confirm_booking_button"
                        id="booking-submit"
                    >
                        Confirm Booking
                    </button>
                </form>
            </div>

            <!-- Campaign 3: Checkbox with true_value -->
            <div class="campaign-section" style="margin-top: 30px">
                <h3>Campaign 3: Checkbox with true_value</h3>
                <p>
                    <strong>Test Case:</strong> Checkbox input with
                    <code>true_value: "on"</code>
                </p>
                <p>
                    Tests: <code>checkbox</code> type input,
                    <code>id</code> selector, <code>true_value</code> matching
                </p>

                <form id="checkbox-form">
                    <div class="form-group">
                        <label for="checkbox-email">Email:</label>
                        <input
                            type="email"
                            name="email"
                            id="checkbox-email"
                            placeholder="Enter your email"
                        />
                    </div>

                    <div class="checkbox-group">
                        <input
                            type="checkbox"
                            id="newletter_cb"
                            value="on"
                            name="newsletter"
                        />
                        <label for="newletter_cb"
                            >Enable pipeline (value="on")</label
                        >
                    </div>

                    <button type="button" name="submit_button">Submit</button>
                </form>
            </div>
        </div>

        <!-- Additional Test Elements -->
        <div class="form-section" style="margin-top: 30px">
            <h3>Additional Selector Type Tests</h3>

            <div class="form-group">
                <label>ID Selector Test:</label>
                <input
                    type="text"
                    id="test-id-input"
                    placeholder="Test input with id selector"
                />
            </div>

            <div class="form-group">
                <label>Class Selector Test:</label>
                <input
                    type="text"
                    class="test-class-input"
                    placeholder="Test input with class selector"
                />
            </div>

            <div class="form-group">
                <label>Data Attribute Selector Test:</label>
                <input
                    type="text"
                    data-test-field="test-value"
                    placeholder="Test input with data attribute"
                />
            </div>
        </div>

        <div id="status" class="status" style="display: none"></div>

        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="../dist/index.js"></script>
        <script>
            // Campaign 1 Configuration
            const campaign1Config = {
                organizationId: "94d03439-383a-43b0-8666-9d7cf5aa17fc",
                checkoutCampaignId: "test-checkout-id",
                pipelineCampaignId: "30893953-c953-4137-b9aa-2a2ff3f9f2e9",
                features: {
                    organizationPipeline: true,
                },
            };

            // Campaign 2 Configuration
            const campaign2Config = {
                organizationId: "94d03439-383a-43b0-8666-9d7cf5aa17fc",
                checkoutCampaignId: "test-checkout-id",
                pipelineCampaignId: "c9edaae1-42e5-4115-b680-b5e22b049411",
                features: {
                    organizationPipeline: true,
                },
            };

            // Initialize SDK for Campaign 1
            const sdk1 = new EkteIntelligensSDK(campaign1Config);
            sdk1.initialize()
                .then((success) => {
                    if (success) {
                        showStatus(
                            "Campaign 1 SDK initialized successfully!",
                            "success"
                        );
                        const tool = sdk1.getOrganizationPipelineTool();
                        if (tool) {
                            console.log("Campaign 1 tool ready");
                            console.log(
                                "Initial form data:",
                                tool.getFormData()
                            );
                        }
                    } else {
                        showStatus(
                            "Campaign 1 SDK initialization failed",
                            "error"
                        );
                    }
                })
                .catch((error) => {
                    showStatus("Campaign 1 Error: " + error.message, "error");
                });

            // Initialize SDK for Campaign 2
            const sdk2 = new EkteIntelligensSDK(campaign2Config);
            sdk2.initialize()
                .then((success) => {
                    if (success) {
                        showStatus(
                            "Campaign 2 SDK initialized successfully!",
                            "success"
                        );
                        const tool = sdk2.getOrganizationPipelineTool();
                        if (tool) {
                            console.log("Campaign 2 tool ready");
                            console.log(
                                "Initial form data:",
                                tool.getFormData()
                            );

                            // Monitor checkbox toggle
                            const checkbox =
                                document.getElementById("newsletter_cb");
                            if (checkbox) {
                                checkbox.addEventListener("change", () => {
                                    console.log(
                                        "Checkbox toggled. Form data:",
                                        tool.getFormData()
                                    );
                                });
                            }
                        }
                    } else {
                        showStatus(
                            "Campaign 2 SDK initialization failed",
                            "error"
                        );
                    }
                })
                .catch((error) => {
                    showStatus("Campaign 2 Error: " + error.message, "error");
                });

            function showStatus(message, type) {
                const statusDiv = document.getElementById("status");
                statusDiv.textContent = message;
                statusDiv.className = `status ${type}`;
                statusDiv.style.display = "block";

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    statusDiv.style.display = "none";
                }, 5000);
            }

            // Log expected campaign configurations
            console.log(`
Campaign 3 Configuration (Checkbox with true_value):
{
    "input_mapping": {
        "email": {
            "type": "input",
            "selector_type": "name",
            "selector_value": "email",
            "default_value": ""
        },
        "ainternal_run_pipeline": {
            "type": "checkbox",
            "selector_type": "id",
            "selector_value": "newletter_cb",
            "true_value": "on"
        }
    },
    "button_mapping": {
        "selector_type": "name",
        "selector_value": "submit_button"
    },
    "additional_properties": {
        "form_id": 79,
        "from_element": "checkbox_form"
    }
}

Campaign 1 Configuration:
{
    "id": "30893953-c953-4137-b9aa-2a2ff3f9f2e9",
    "input_mapping": {
        "email": {
            "type": "input",
            "default_value": "",
            "selector_type": "name",
            "selector_value": "email"
        }
    },
    "button_mapping": {
        "selector_type": "querySelector",
        "selector_value": "body > div.bv-ibe > div.styleThemeContainer.bv-group.bv-contents > div > main > form > div.bv-flex.bv-justify-between.bv-gap-\\\\[20px\\\\] > button"
    },
    "additional_properties": {
        "form_id": 79,
        "from_element": "signup_form",
        "ainternal_run_pipeline": true
    }
}

Campaign 2 Configuration:
{
    "id": "c9edaae1-42e5-4115-b680-b5e22b049411",
    "input_mapping": {
        "email": {
            "type": "input",
            "default_value": "",
            "selector_type": "name",
            "selector_value": "emailAddress"
        },
        "ainternal_run_pipeline": {
            "mode": "toggle",
            "type": "button",
            "default_value": false,
            "selector_type": "id",
            "selector_value": "newsletter_cb"
        }
    },
    "button_mapping": {
        "selector_type": "name",
        "selector_value": "confirm_booking_button"
    },
    "additional_properties": {
        "status": "Booket",
        "form_id": 79,
        "from_element": "booking_form"
    }
}
            `);
        </script>
    </body>
</html>
